metadata:
  name: camera demo
  description: to test only the camera interface

# modules expose inputs and outputs from various sources
modules:
  local_server: 
    Server:
      port: 8080
      root_context: /
      inputs: 
        enable_camera: 
          Bool: { start: false }
        mjpeg_quality:
          Float: { start: 50, min: 0, max: 100, step: 1 }
        camera_framerate:
          Float: { start: 5, min: 1, max: 60, step: 1 }
      outputs:
        jpeg_frames: Binary
      endpoints: 
        "/ws":
          WebSocket: 
            inputs: [ enable_camera, mjpeg_quality, camera_framerate ]
            outputs: [ ]
        "/stream":
          Mjpeg:
            output: jpeg_frames
 
  camera:
    RaspiCam: {}

transformers: {}

# pipes read from inputs and write to outputs
pipes:
  - { from: camera.mjpeg, to: local_server.jpeg_frames }
  - { from: local_server.enable_camera, to: camera.enable }
  - { from: local_server.mjpeg_quality, to: camera.quality }
  - { from: local_server.camera_framerate, to: camera.framerate }