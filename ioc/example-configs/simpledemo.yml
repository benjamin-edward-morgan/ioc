metadata:
  name: simple demo
  description: mostly just for local dev

modules:
  local_server: 
    Server:
      port: 8080
      root_context: /
      inputs:
        p: 
          Float: { start: 1.0, min: 0.0, max: 10.0, step: 0.01 }
        i: 
          Float: { start: 0.0, min: 0.0, max: 10.0, step: 0.01 }
        d: 
          Float: { start: 0.0, min: 0.0, max: 10.0, step: 0.01 }
        set_point: 
          Float: { start: 0.0, min: -10.0, max: 10.0, step: 0.01}
      outputs:
        process_var: Float
      endpoints: 
        "/ws":
          WebSocket: 
            inputs: [ p, i, d, set_point ]
            outputs: [ process_var ]

  feedback:
    Feedback:
      items:
        process_var: 
          Float:
            start: 0.0

transformers:

  avg:
    WindowAverage:
      input: feedback.process_var
      period_ms: 50

  pid:
    PID:
      p: local_server.p
      i: local_server.i
      d: local_server.d
      set_point: local_server.set_point 
      process_var: avg.value
      period_ms: 100 

  limiter:
    Limiter:
      input: pid.value
      min: -10
      max: 10
      vmin: -200
      vmax: 200
      amin: -50
      amax: 50
      period_ms: 25

pipes:
  - { from: limiter.value, to: local_server.process_var }
  - { from: limiter.value, to: feedback.process_var }
